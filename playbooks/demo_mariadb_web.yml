---
# Deploy MariaDB Web Demo Application
# This playbook deploys a PHP web interface to test database replication
# Author: Ansible Automation
# Date: 2025-12-25

- name: "Deploy Web Demo on Primary Server"
  hosts: web_servers[0]
  become: yes
  gather_facts: yes
  
  vars:
    db_role: "primary"
  
  tasks:
    - name: "Include web demo deployment tasks"
      ansible.builtin.include_role:
        name: mariadb_replication
        tasks_from: deploy_web_demo

- name: "Deploy Web Demo on Replica Server"
  hosts: web_servers[1]
  become: yes
  gather_facts: yes
  
  vars:
    db_role: "replica"
  
  tasks:
    - name: "Include web demo deployment tasks"
      ansible.builtin.include_role:
        name: mariadb_replication
        tasks_from: deploy_web_demo

- name: "Demo Instructions"
  hosts: localhost
  gather_facts: no
  
  tasks:
    - name: "Display demo instructions"
      ansible.builtin.debug:
        msg: |
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘      MariaDB Replication Web Demo Deployed!                  â•‘
          â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
          â•‘                                                               â•‘
          â•‘  ğŸŒ Access the demo application:                              â•‘
          â•‘    http://192.168.1.100/db-demo/                              â•‘
          â•‘                                                               â•‘
          â•‘  ğŸ”„ How to test replication:                                  â•‘
          â•‘                                                               â•‘
          â•‘  Step 1: Open VIP in browser                                 â•‘
          â•‘    - Refresh until you see WEB-1 (PRIMARY)                    â•‘
          â•‘    - Note the URL or open in one tab                          â•‘
          â•‘                                                               â•‘
          â•‘  Step 2: Open VIP in another tab                             â•‘
          â•‘    - Refresh until you see WEB-2 (REPLICA)                    â•‘
          â•‘                                                               â•‘
          â•‘  Step 3: Add a user on PRIMARY                                â•‘
          â•‘    - Fill in username and email                               â•‘
          â•‘    - Click "Add User"                                         â•‘
          â•‘                                                               â•‘
          â•‘  Step 4: Refresh REPLICA page                                 â•‘
          â•‘    - The new user should appear!                              â•‘
          â•‘    - Check the "Created On Server" column                     â•‘
          â•‘                                                               â•‘
          â•‘  âœ… Expected Result:                                          â•‘
          â•‘    - Data added on PRIMARY appears on REPLICA                 â•‘
          â•‘    - Sync time: < 1 second                                    â•‘
          â•‘    - Both servers show the same data                          â•‘
          â•‘                                                               â•‘
          â•‘  ğŸ“Š Direct access (for testing):                              â•‘
          â•‘    - PRIMARY: http://192.168.1.27/db-demo/                    â•‘
          â•‘    - REPLICA: http://192.168.1.30/db-demo/                    â•‘
          â•‘                                                               â•‘
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
