---
# File: playbooks/cleanup_wazuh_server.yml
# MÃ´ táº£: Dá»n dáº¹p hoÃ n toÃ n Wazuh Server Ä‘á»ƒ cÃ i láº¡i tá»« Ä‘áº§u

- name: Cleanup Wazuh Server Installation
  hosts: wazuh_server
  become: yes
  gather_facts: yes

  tasks:
    - name: "âš ï¸  Cáº£nh bÃ¡o: Sáº½ xÃ³a hoÃ n toÃ n Wazuh Server"
      ansible.builtin.debug:
        msg: |
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘          âš ï¸  WAZUH SERVER CLEANUP WARNING                      â•‘
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          Sáº½ XÃ“A HOÃ€N TOÃ€N:
          â”œâ”€ Wazuh Manager
          â”œâ”€ Wazuh Indexer
          â”œâ”€ Wazuh Dashboard
          â”œâ”€ Filebeat
          â”œâ”€ Táº¥t cáº£ cáº¥u hÃ¬nh
          â””â”€ Táº¥t cáº£ dá»¯ liá»‡u
          
          â±ï¸  Äá»£i 10 giÃ¢y Ä‘á»ƒ há»§y (Ctrl+C)...
          
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    - name: "Äá»£i 10 giÃ¢y"
      ansible.builtin.pause:
        seconds: 10

    - name: "Stop táº¥t cáº£ Wazuh services"
      ansible.builtin.systemd:
        name: "{{ item }}"
        state: stopped
      loop:
        - wazuh-manager
        - wazuh-indexer
        - wazuh-dashboard
        - filebeat
      failed_when: false

    - name: "Disable táº¥t cáº£ Wazuh services"
      ansible.builtin.systemd:
        name: "{{ item }}"
        enabled: no
      loop:
        - wazuh-manager
        - wazuh-indexer
        - wazuh-dashboard
        - filebeat
      failed_when: false

    - name: "Gá»¡ cÃ i Ä‘áº·t Wazuh packages"
      ansible.builtin.package:
        name:
          - wazuh-manager
          - wazuh-indexer
          - wazuh-dashboard
          - filebeat
        state: absent
      failed_when: false

    - name: "XÃ³a thÆ° má»¥c Wazuh"
      ansible.builtin.file:
        path: "{{ item }}"
        state: absent
      loop:
        - /var/ossec
        - /etc/wazuh-indexer
        - /var/lib/wazuh-indexer
        - /usr/share/wazuh-indexer
        - /etc/wazuh-dashboard
        - /var/lib/wazuh-dashboard
        - /usr/share/wazuh-dashboard
        - /etc/filebeat
        - /var/lib/filebeat
        - /var/log/filebeat
        - /etc/wazuh-certificates

    - name: "XÃ³a Wazuh repository"
      ansible.builtin.file:
        path: /etc/yum.repos.d/wazuh.repo
        state: absent
      when: ansible_os_family == "RedHat"

    - name: "XÃ³a user vÃ  group"
      ansible.builtin.user:
        name: "{{ item }}"
        state: absent
        remove: yes
      loop:
        - wazuh
        - wazuh-indexer
        - wazuh-dashboard
      failed_when: false

    - name: "Hiá»ƒn thá»‹ káº¿t quáº£"
      ansible.builtin.debug:
        msg: |
          
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘          âœ… WAZUH SERVER CLEANUP COMPLETED                     â•‘
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          âœ… ÄÃ£ xÃ³a hoÃ n toÃ n Wazuh Server
          
          ğŸ“ BÃ¢y giá» cÃ³ thá»ƒ cÃ i láº¡i:
          ansible-playbook -i inventory.ini playbooks/deploy_wazuh_server.yml
          
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
