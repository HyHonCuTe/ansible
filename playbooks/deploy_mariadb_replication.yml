---
# MariaDB Replication Deployment Playbook
# Deploy MariaDB with Primary-Replica replication on Web Servers
# Author: Ansible Automation
# Date: 2025-12-25

- name: "Deploy MariaDB Primary Server"
  hosts: web_servers[0]  # Web1 - Primary
  become: yes
  gather_facts: yes
  
  vars:
    mariadb_replication_role: "primary"
    mariadb_server_id: 1
  
  tasks:
    - name: "Display deployment banner - Primary"
      ansible.builtin.debug:
        msg: |
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘      Deploying MariaDB Primary Server                 â•‘
          â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
          â•‘  Host: {{ ansible_hostname }}
          â•‘  IP: {{ ansible_host }}
          â•‘  Role: PRIMARY
          â•‘  Server ID: {{ mariadb_server_id }}
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    - name: "Include mariadb_replication role"
      ansible.builtin.include_role:
        name: mariadb_replication

- name: "Deploy MariaDB Replica Server"
  hosts: web_servers[1]  # Web2 - Replica
  become: yes
  gather_facts: yes
  
  vars:
    mariadb_replication_role: "replica"
    mariadb_server_id: 2
  
  tasks:
    - name: "Display deployment banner - Replica"
      ansible.builtin.debug:
        msg: |
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘      Deploying MariaDB Replica Server                 â•‘
          â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
          â•‘  Host: {{ ansible_hostname }}
          â•‘  IP: {{ ansible_host }}
          â•‘  Role: REPLICA
          â•‘  Server ID: {{ mariadb_server_id }}
          â•‘  Primary: {{ hostvars[groups['web_servers'][0]]['ansible_host'] }}
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    - name: "Include mariadb_replication role"
      ansible.builtin.include_role:
        name: mariadb_replication

- name: "Deployment Summary"
  hosts: localhost
  gather_facts: no
  
  vars:
    primary_host: "{{ hostvars[groups['web_servers'][0]]['ansible_host'] }}"
    replica_host: "{{ hostvars[groups['web_servers'][1]]['ansible_host'] }}"
  
  tasks:
    - name: "Display deployment summary"
      ansible.builtin.debug:
        msg: |
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘      MariaDB Replication Deployment Complete!                â•‘
          â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
          â•‘                                                               â•‘
          â•‘  ğŸ”µ PRIMARY Server:                                           â•‘
          â•‘    - Host: {{ primary_host }} (Web1)
          â•‘    - Server ID: 1                                             â•‘
          â•‘    - Role: Read/Write                                         â•‘
          â•‘                                                               â•‘
          â•‘  ğŸŸ¢ REPLICA Server:                                           â•‘
          â•‘    - Host: {{ replica_host }} (Web2)
          â•‘    - Server ID: 2                                             â•‘
          â•‘    - Role: Read-only (synced from Primary)                    â•‘
          â•‘                                                               â•‘
          â•‘  ğŸ“Š Demo Database:                                            â•‘
          â•‘    - Name: webapp_db                                          â•‘
          â•‘    - User: webapp_user                                        â•‘
          â•‘    - Tables: users, visits                                    â•‘
          â•‘                                                               â•‘
          â•‘  ğŸ” Credentials:                                              â•‘
          â•‘    - Root Password: RootP@ssw0rd2025                          â•‘
          â•‘    - App User: webapp_user / WebApp123!                       â•‘
          â•‘                                                               â•‘
          â•‘  âœ… Next Steps:                                               â•‘
          â•‘    1. Verify replication: ansible-playbook verify_mariadb_replication.yml â•‘
          â•‘    2. Test with web demo: ansible-playbook demo_mariadb_web.yml â•‘
          â•‘                                                               â•‘
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
