# ==========================================
# Deploy Zabbix Agents (FIX: ThÃªm pháº§n nÃ y)
# ==========================================
- name: "Deploy Zabbix Agents"
  hosts: zabbix_agents
  become: yes
  gather_facts: yes
  tags:
    - install_agent
    - zabbix_agents
  roles:
    - role: zabbix
      tasks_from: install_agent
  
# ==========================================
# Add Zabbix Agent Hosts to ServerSS
# ==========================================
- name: "Add agent hosts to Zabbix Server"
  hosts: zabbix_agents
  gather_facts: yes
  tags:
    - add_host
    - zabbix_agents
  tasks:
    - name: "Include add host tasks"
      include_role:
        name: zabbix
        tasks_from: add_host

- name: "Display deployment summary"
  hosts: zabbix_server
  become: yes
  tags:
    - always
  
  tasks:
    - name: "Get server IP"
      set_fact:
        server_ip: "{{ ansible_default_ipv4.address }}"
    
    - name: "Display final summary"
      debug:
        msg: |
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘   âœ… Zabbix Deployment Completed!             â•‘
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          ğŸ“Š Web Interface:
             URL: http://{{ server_ip }}/zabbix
             Username: Admin
             Password: zabbix
          
          ğŸ” SECURITY CHECKLIST:
             â˜‘ Login to Web UI
             â˜‘ Change Admin password immediately
             â˜‘ Update database passwords in vars
             â˜‘ Configure email notifications
          
          ğŸ“¡ Deploy agents:
             ansible-playbook playbooks/deploy-zabbix.yml --tags zabbix_agents
          
          ğŸ“– Helper commands:
             sudo zabbix-add-host
             sudo systemctl status zabbix-server
             sudo tail -f /var/log/zabbix/zabbix_server.log