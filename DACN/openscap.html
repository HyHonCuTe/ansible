<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H∆∞·ªõng d·∫´n OpenSCAP - AlmaLinux 9</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .step {
            background: #f8f9fa;
            border-left: 5px solid #667eea;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 5px;
            transition: transform 0.3s ease;
        }
        
        .step:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .step-number {
            background: #667eea;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            margin-right: 15px;
        }
        
        .step-title {
            font-size: 1.5em;
            color: #667eea;
            font-weight: bold;
        }
        
        .description {
            background: #e3f2fd;
            border-left: 3px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .description h4 {
            color: #1976d2;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .description ul {
            margin-left: 20px;
        }
        
        .description li {
            margin: 5px 0;
        }
        
        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 5px;
            margin: 15px 0;
            position: relative;
            overflow-x: auto;
        }
        
        .code-block code {
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.95em;
            line-height: 1.5;
            white-space: pre;
            display: block;
        }
        
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s ease;
        }
        
        .copy-btn:hover {
            background: #5568d3;
        }
        
        .copy-btn:active {
            background: #4a5bc4;
        }
        
        .warning {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .warning strong {
            color: #856404;
            display: block;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .success {
            background: #d4edda;
            border-left: 5px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .info {
            background: #d1ecf1;
            border-left: 5px solid #17a2b8;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .profiles {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .profile-card {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .profile-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }
        
        .profile-card h4 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .profile-card code {
            background: #f5f5f5;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.85em;
            color: #d63384;
            display: block;
            margin: 10px 0;
            word-break: break-all;
        }
        
        .checklist {
            background: white;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .checklist h3 {
            color: #28a745;
            margin-bottom: 15px;
        }
        
        .checklist-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .checklist-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 15px;
            cursor: pointer;
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 25px;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            display: none;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .command-explain {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-size: 0.9em;
        }
        
        .command-explain strong {
            color: #667eea;
        }
        
        footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 30px;
        }
        
        .toc {
            background: #f8f9fa;
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .toc h3 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .toc ul {
            list-style: none;
        }
        
        .toc li {
            padding: 8px 0;
        }
        
        .toc a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .toc a:hover {
            color: #764ba2;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="toast" id="toast">‚úÖ ƒê√£ copy v√†o clipboard!</div>
    
    <div class="container">
        <header>
            <h1>üîê H∆∞·ªõng d·∫´n OpenSCAP l·ªánh ch·∫°y CMD</h1>
            <p>Scan v√† Kh·∫Øc ph·ª•c B·∫£o m·∫≠t cho AlmaLinux 9</p>
            <p style="font-size: 0.9em; margin-top: 10px;">C·∫≠p nh·∫≠t: 2025-10-11 | T√°c gi·∫£: HyHonCuTe</p>
        </header>
        
        <div class="content">
            <!-- M·ª•c l·ª•c -->
            <div class="toc">
                <h3>üìë M·ª•c l·ª•c</h3>
                <ul>
                    <li><a href="#step1">B∆∞·ªõc 1: C√†i ƒë·∫∑t OpenSCAP</a></li>
                    <li><a href="#step2">B∆∞·ªõc 2: Scan h·ªá th·ªëng</a></li>
                    <li><a href="#step3">B∆∞·ªõc 3: Xem k·∫øt qu·∫£</a></li>
                    <li><a href="#step4">B∆∞·ªõc 4: Backup</a></li>
                    <li><a href="#step5">B∆∞·ªõc 5: Kh·∫Øc ph·ª•c t·ª± ƒë·ªông</a></li>
                    <li><a href="#step6">B∆∞·ªõc 6: So s√°nh k·∫øt qu·∫£</a></li>
                    <li><a href="#step7">B∆∞·ªõc 7: Restore</a></li>
                    <li><a href="#profiles">Profiles kh√°c</a></li>
                    <li><a href="#script">Script t·ª± ƒë·ªông</a></li>
                    <li><a href="#command">Ch·∫°y b·∫±ng Ansible</a></li>
                </ul>
            </div>
            
            <!-- Gi·ªõi thi·ªáu -->
            <div class="info">
                <h4>üìñ Gi·ªõi thi·ªáu v·ªÅ OpenSCAP</h4>
                <p><strong>OpenSCAP</strong> l√† framework m√£ ngu·ªìn m·ªü ƒë·ªÉ ki·ªÉm tra b·∫£o m·∫≠t v√† tu√¢n th·ªß ti√™u chu·∫©n (compliance) tr√™n Linux.</p>
                <ul>
                    <li><strong>SCAP</strong> = Security Content Automation Protocol</li>
                    <li><strong>XCCDF</strong> = Extensible Configuration Checklist Description Format</li>
                    <li><strong>OVAL</strong> = Open Vulnerability and Assessment Language</li>
                    <li><strong>Profile</strong> = T·∫≠p h·ª£p c√°c rules b·∫£o m·∫≠t (VD: CIS, STIG, PCI-DSS)</li>
                </ul>
            </div>
            
            <!-- B∆∞·ªõc 1 -->
            <div class="step" id="step1">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <div class="step-title">C√†i ƒë·∫∑t OpenSCAP</div>
                </div>
                
                <div class="description">
                    <h4>üì¶ M√¥ t·∫£</h4>
                    <p>C√†i ƒë·∫∑t 2 g√≥i c·∫ßn thi·∫øt:</p>
                    <ul>
                        <li><strong>openscap-scanner</strong>: C√¥ng c·ª• ch√≠nh ƒë·ªÉ scan v√† fix</li>
                        <li><strong>scap-security-guide</strong>: Ch·ª©a c√°c profile b·∫£o m·∫≠t (CIS, STIG, PCI-DSS...)</li>
                    </ul>
                </div>
                
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code>sudo dnf install -y openscap-scanner scap-security-guide</code><pre>
                </div>
                
                <div class="command-explain">
                    <strong>Gi·∫£i th√≠ch:</strong><br>
                    ‚Ä¢ <pre><code>dnf</code><pre>: Package manager c·ªßa RHEL/AlmaLinux<br>
                    ‚Ä¢ <pre><code>-y</code><pre>: T·ª± ƒë·ªông x√°c nh·∫≠n c√†i ƒë·∫∑t (kh√¥ng h·ªèi yes/no)<br>
                    ‚Ä¢ Th·ªùi gian: ~2-5 ph√∫t
                </div>
            </div>
            
            <!-- B∆∞·ªõc 2 -->
            <div class="step" id="step2">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <div class="step-title">Scan H·ªá th·ªëng</div>
                </div>
                
                <div class="description">
                    <h4>üîç M√¥ t·∫£</h4>
                    <p>Qu√©t h·ªá th·ªëng v·ªõi profile <strong>CIS Level 1 Server</strong> - Ti√™u chu·∫©n b·∫£o m·∫≠t ph·ªï bi·∫øn nh·∫•t.</p>
                    <ul>
                        <li>Ki·ªÉm tra <strong>266 rules</strong> b·∫£o m·∫≠t</li>
                        <li>Th·ªùi gian: <strong>3-5 ph√∫t</strong></li>
                        <li>T·∫°o 2 files: XML (k·∫øt qu·∫£ chi ti·∫øt) v√† HTML (b√°o c√°o d·ªÖ ƒë·ªçc)</li>
                    </ul>
                </div>
                
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code># T·∫°o th∆∞ m·ª•c l∆∞u k·∫øt qu·∫£
sudo mkdir -p /var/tmp/scap

# Ch·∫°y scan
sudo oscap xccdf eval \
  --fetch-remote-resources \
  --profile xccdf_org.ssgproject.content_profile_cis_server_l1 \
  --results /var/tmp/scap/scan-results.xml \
  --report /var/tmp/scap/scan-report.html \
  /usr/share/xml/scap/ssg/content/ssg-almalinux9-ds.xml</code><pre>
                </div>
                
                <div class="command-explain">
                    <strong>Gi·∫£i th√≠ch t·ª´ng tham s·ªë:</strong><br>
                    ‚Ä¢ <pre><code>oscap xccdf eval</code><pre>: L·ªánh ch√≠nh ƒë·ªÉ ch·∫°y scan<br>
                    ‚Ä¢ <pre><code>--fetch-remote-resources</code><pre>: T·ª± ƒë·ªông download OVAL definitions t·ª´ internet<br>
                    ‚Ä¢ <pre><code>--profile</code><pre>: Ch·ªçn profile CIS Level 1 Server<br>
                    ‚Ä¢ <pre><code>--results</code><pre>: File XML ch·ª©a k·∫øt qu·∫£ chi ti·∫øt (d√πng ƒë·ªÉ generate fix)<br>
                    ‚Ä¢ <pre><code>--report</code><pre>: File HTML b√°o c√°o (m·ªü b·∫±ng browser)<br>
                    ‚Ä¢ <pre><code>/usr/share/xml/scap/ssg/content/ssg-almalinux9-ds.xml</code><pre>: File SCAP datastream
                </div>
                
                <div class="warning">
                    <strong>‚ö†Ô∏è L∆∞u √Ω</strong>
                    <ul>
                        <li>L·ªánh n√†y <strong>CH·ªà SCAN</strong>, kh√¥ng thay ƒë·ªïi g√¨</li>
                        <li>Exit code = 0: Pass ho√†n to√†n</li>
                        <li>Exit code = 2: C√≥ findings (b√¨nh th∆∞·ªùng)</li>
                    </ul>
                </div>
            </div>
            
            <!-- B∆∞·ªõc 3 -->
            <div class="step" id="step3">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <div class="step-title">Xem K·∫øt qu·∫£</div>
                </div>
                
                <div class="description">
                    <h4>üìä M√¥ t·∫£</h4>
                    <p>Ph√¢n t√≠ch file XML ƒë·ªÉ ƒë·∫øm s·ªë l·ªói PASS v√† FAIL</p>
                </div>
                
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code># ƒê·∫øm s·ªë l·ªói
FAIL=$(sed -n 's/.*&lt;result&gt;\([^&lt;]*\)&lt;\/result&gt;.*/\1/p' /var/tmp/scap/scan-results.xml | grep -c "^fail$")
PASS=$(sed -n 's/.*&lt;result&gt;\([^&lt;]*\)&lt;\/result&gt;.*/\1/p' /var/tmp/scap/scan-results.xml | grep -c "^pass$")

echo "‚ùå Failed: $FAIL"
echo "‚úÖ Passed: $PASS"</code><pre>
                </div>
                
                <div class="command-explain">
                    <strong>Gi·∫£i th√≠ch:</strong><br>
                    ‚Ä¢ <pre><code>sed -n</code><pre>: Stream editor ƒë·ªÉ parse XML<br>
                    ‚Ä¢ <pre><code>&lt;result&gt;...&lt;/result&gt;</code><pre>: Tr√≠ch xu·∫•t gi√° tr·ªã k·∫øt qu·∫£<br>
                    ‚Ä¢ <pre><code>grep -c "^fail$"</code><pre>: ƒê·∫øm s·ªë d√≤ng ch·ª©a "fail"
                </div>
                
                <div class="info">
                    <strong>üí° Xem b√°o c√°o HTML ƒë·∫πp h∆°n:</strong><br>
                    Copy file v·ªÅ m√°y local v√† m·ªü b·∫±ng browser:
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        <pre><code>scp suricata@192.168.1.248:/var/tmp/scap/scan-report.html ~/Desktop/</code><pre>
                    </div>
                    (Thay <pre><code>suricata@192.168.1.248</code><pre> b·∫±ng user@IP c·ªßa b·∫°n)
                </div>
            </div>
            
            <!-- B∆∞·ªõc 4 -->
            <div class="step" id="step4">
                <div class="step-header">
                    <div class="step-number">4</div>
                    <div class="step-title">Backup (B·∫ÆT BU·ªòC!)</div>
                </div>
                
                <div class="warning">
                    <strong>üö® QUAN TR·ªåNG NH·∫§T!</strong>
                    <p>LU√îN LU√îN backup tr∆∞·ªõc khi ch·∫°y remediation! M·ªôt s·ªë fix c√≥ th·ªÉ:</p>
                    <ul>
                        <li>‚ùå Lock SSH (kh√¥ng login ƒë∆∞·ª£c)</li>
                        <li>‚ùå Break services</li>
                        <li>‚ùå Thay ƒë·ªïi file h·ªá th·ªëng</li>
                    </ul>
                </div>
                
                <div class="description">
                    <h4>üíæ M√¥ t·∫£</h4>
                    <p>Backup c√°c file c·∫•u h√¨nh quan tr·ªçng v√†o file .tar.gz</p>
                    <ul>
                        <li><strong>/etc/ssh/</strong>: C·∫•u h√¨nh SSH</li>
                        <li><strong>/etc/pam.d/</strong>: C·∫•u h√¨nh x√°c th·ª±c PAM</li>
                        <li><strong>/etc/security/</strong>: Ch√≠nh s√°ch b·∫£o m·∫≠t</li>
                        <li><strong>/etc/sudoers</strong>: Quy·ªÅn sudo</li>
                        <li><strong>/etc/sysctl.conf</strong>: Kernel parameters</li>
                        <li><strong>/etc/fstab</strong>: File systems</li>
                        <li><strong>/etc/audit/</strong>: Audit logs</li>
                    </ul>
                </div>
                
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code>sudo tar -czf ~/backup_$(date +%Y%m%d_%H%M%S).tar.gz \
  /etc/ssh/ /etc/pam.d/ /etc/security/ /etc/login.defs \
  /etc/sudoers /etc/sysctl.conf /etc/fstab /etc/audit/ \
  2>/dev/null

sudo chown $USER:$USER ~/backup_*.tar.gz
ls -lh ~/backup_*.tar.gz | tail -1</code><pre>
                </div>
                
                <div class="command-explain">
                    <strong>Gi·∫£i th√≠ch:</strong><br>
                    ‚Ä¢ <pre><code>tar -czf</code><pre>: T·∫°o file n√©n (.tar.gz)<br>
                    ‚Ä¢ <pre><code>$(date +%Y%m%d_%H%M%S)</code><pre>: Timestamp (VD: 20251011_153829)<br>
                    ‚Ä¢ <pre><code>2>/dev/null</code><pre>: ·∫®n l·ªói n·∫øu file kh√¥ng t·ªìn t·∫°i<br>
                    ‚Ä¢ <pre><code>chown $USER:$USER</code><pre>: ƒê·ªïi owner v·ªÅ user hi·ªán t·∫°i<br>
                    ‚Ä¢ File backup l∆∞u ·ªü: <pre><code>~/backup_YYYYMMDD_HHMMSS.tar.gz</code><pre>
                </div>
                
                <div class="success">
                    <strong>‚úÖ Ki·ªÉm tra backup th√†nh c√¥ng:</strong><br>
                    File c√≥ dung l∆∞·ª£ng > 1MB l√† OK
                </div>
            </div>
            
            <!-- B∆∞·ªõc 5 -->
            <div class="step" id="step5">
                <div class="step-header">
                    <div class="step-number">5</div>
                    <div class="step-title">Kh·∫Øc ph·ª•c T·ª± ƒë·ªông</div>
                </div>
                
                <div class="warning">
                    <strong>‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è C·∫¢NH B√ÅO NGHI√äM TR·ªåNG ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è</strong>
                    <p>L·ªánh n√†y s·∫Ω <strong>THAY ƒê·ªîI TR·ª∞C TI·∫æP</strong> h·ªá th·ªëng!</p>
                    <ul>
                        <li>üî¥ C√≥ th·ªÉ lock SSH</li>
                        <li>üî¥ C√≥ th·ªÉ y√™u c·∫ßu reboot</li>
                        <li>üî¥ Kh√¥ng c√≥ undo</li>
                    </ul>
                    <p><strong>CH·ªà CH·∫†Y N·∫æU:</strong></p>
                    <ul>
                        <li>‚úÖ ƒê√£ backup</li>
                        <li>‚úÖ C√≥ console access (ho·∫∑c ƒë√£ snapshot VM)</li>
                        <li>‚úÖ ƒê·ªçc k·ªπ scan report tr∆∞·ªõc</li>
                    </ul>
                </div>
                
                <div class="description">
                    <h4>üîß M√¥ t·∫£</h4>
                    <p>S·ª≠ d·ª•ng tham s·ªë <pre><code>--remediate</code><pre> ƒë·ªÉ t·ª± ƒë·ªông fix T·∫§T C·∫¢ l·ªói ƒë√£ ph√°t hi·ªán</p>
                    <ul>
                        <li>Th·ªùi gian: <strong>5-10 ph√∫t</strong></li>
                        <li>T·ª± ƒë·ªông s·ª≠a: c·∫•u h√¨nh SSH, PAM, sysctl, file permissions, audit rules...</li>
                        <li>T·∫°o report sau khi fix</li>
                    </ul>
                </div>
                
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code>sudo oscap xccdf eval \
  --remediate \
  --fetch-remote-resources \
  --profile xccdf_org.ssgproject.content_profile_cis_server_l1 \
  --results /var/tmp/scap/after-fix.xml \
  --report /var/tmp/scap/after-fix.html \
  /usr/share/xml/scap/ssg/content/ssg-almalinux9-ds.xml \
  2>&1 | tee /tmp/fix.log</code><pre>
                </div>
                
                <div class="command-explain">
                    <strong>Gi·∫£i th√≠ch tham s·ªë m·ªõi:</strong><br>
                    ‚Ä¢ <pre><code>--remediate</code><pre>: <strong>KEY PARAMETER</strong> - B·∫≠t ch·∫ø ƒë·ªô t·ª± ƒë·ªông fix<br>
                    ‚Ä¢ <pre><code>2>&1</code><pre>: Redirect stderr sang stdout<br>
                    ‚Ä¢ <pre><code>| tee /tmp/fix.log</code><pre>: V·ª´a hi·ªÉn th·ªã v·ª´a l∆∞u log
                </div>
                
                <div class="info">
                    <strong>üí° Trong l√∫c ch·∫°y:</strong><br>
                    ‚Ä¢ S·∫Ω th·∫•y nhi·ªÅu d√≤ng "Remediating..." tr√™n m√†n h√¨nh<br>
                    ‚Ä¢ M·ªôt s·ªë service c√≥ th·ªÉ restart t·ª± ƒë·ªông<br>
                    ‚Ä¢ M·ªû TERMINAL M·ªöI v√† test SSH ngay sau khi xong!
                </div>
            </div>
            
            <!-- B∆∞·ªõc 6 -->
            <div class="step" id="step6">
                <div class="step-header">
                    <div class="step-number">6</div>
                    <div class="step-title">So s√°nh K·∫øt qu·∫£</div>
                </div>
                
                <div class="description">
                    <h4>üìä M√¥ t·∫£</h4>
                    <p>So s√°nh s·ªë l·ªói TR∆Ø·ªöC v√† SAU khi fix ƒë·ªÉ ƒë√°nh gi√° hi·ªáu qu·∫£</p>
                </div>
                
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code>BEFORE=$(sed -n 's/.*&lt;result&gt;\([^&lt;]*\)&lt;\/result&gt;.*/\1/p' /var/tmp/scap/scan-results.xml | grep -c "^fail$")
AFTER=$(sed -n 's/.*&lt;result&gt;\([^&lt;]*\)&lt;\/result&gt;.*/\1/p' /var/tmp/scap/after-fix.xml | grep -c "^fail$")
FIXED=$((BEFORE - AFTER))

echo "üìä ===== K·∫æT QU·∫¢ ====="
echo "Tr∆∞·ªõc: $BEFORE l·ªói"
echo "Sau:   $AFTER l·ªói"
echo "ƒê√£ fix: $FIXED l·ªói ($(echo "scale=1; ($FIXED*100)/$BEFORE" | bc)%)"</code><pre>
                </div>
                
                <div class="success">
                    <strong>‚úÖ K·∫øt qu·∫£ t·ªët:</strong><br>
                    ‚Ä¢ Fix ƒë∆∞·ª£c > 70%: Tuy·ªát v·ªùi!<br>
                    ‚Ä¢ Fix ƒë∆∞·ª£c 50-70%: T·ªët (m·ªôt s·ªë l·ªói c·∫ßn fix th·ªß c√¥ng)<br>
                    ‚Ä¢ Fix ƒë∆∞·ª£c < 30%: C·∫ßn ki·ªÉm tra l·∫°i
                </div>

                ">
                
                <div class="info">
                    <strong>üí° M·ªôt s·ªë l·ªói KH√îNG TH·ªÇ t·ª± ƒë·ªông fix:</strong><br>
                    ‚Ä¢ Partition ri√™ng cho /tmp, /var (c·∫ßn repartition disk)<br>
                    ‚Ä¢ Install firewall (n·∫øu ch∆∞a c√†i)<br>
                    ‚Ä¢ SELinux enable (c·∫ßn reboot)<br>
                    ‚Ä¢ M·ªôt s·ªë config ƒë·∫∑c th√π m√¥i tr∆∞·ªùng
                </div>
            </div>
            
            <!-- B∆∞·ªõc 7 -->
            <div class="step" id="step7">
                <div class="step-header">
                    <div class="step-number">7</div>
                    <div class="step-title">Restore (N·∫øu c√≥ v·∫•n ƒë·ªÅ)</div>
                </div>
                
                <div class="warning">
                    <strong>üîô Khi n√†o c·∫ßn restore?</strong>
                    <ul>
                        <li>‚ùå Kh√¥ng SSH ƒë∆∞·ª£c</li>
                        <li>‚ùå Services kh√¥ng ch·∫°y</li>
                        <li>‚ùå H·ªá th·ªëng l·ªói</li>
                    </ul>
                </div>
                
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code># Restore t·∫•t c·∫£ t·ª´ backup
sudo tar -xzf ~/backup_*.tar.gz -C /

# Restart services
sudo systemctl restart sshd
sudo systemctl restart auditd

# Reboot n·∫øu c·∫ßn
sudo reboot</code><pre>
                </div>
                
                <div class="command-explain">
                    <strong>Gi·∫£i th√≠ch:</strong><br>
                    ‚Ä¢ <pre><code>tar -xzf</code><pre>: Extract file n√©n<br>
                    ‚Ä¢ <pre><code>-C /</code><pre>: Gi·∫£i n√©n v√†o root directory (ghi ƒë√® file c≈©)<br>
                    ‚Ä¢ <pre><code>systemctl restart</code><pre>: Restart services ƒë·ªÉ apply config c≈©
                </div>
            </div>
            
            <!-- Profiles -->
            <div class="step" id="profiles">
                <div class="step-header">
                    <div class="step-number">üìã</div>
                    <div class="step-title">C√°c Profile Kh√°c</div>
                </div>
                
                <div class="description">
                    <h4>üéØ Ch·ªçn Profile ph√π h·ª£p v·ªõi nhu c·∫ßu</h4>
                    <p>Thay th·∫ø gi√° tr·ªã <pre><code>--profile</code><pre> trong l·ªánh scan/fix</p>
                </div>
                
                <div class="profiles">
                    <div class="profile-card">
                        <h4>ü•á CIS Level 1 Server</h4>
                        <p><strong>Khuy·∫øn ngh·ªã cho h·∫ßu h·∫øt</strong></p>
                        <p>ƒê·ªô nghi√™m: ‚≠ê‚≠ê V·ª´a ph·∫£i</p>
                        <pre><code>xccdf_org.ssgproject.content_profile_cis_server_l1</code><pre>
                    </div>
                    
                    <div class="profile-card">
                        <h4>ü•à CIS Level 2 Server</h4>
                        <p>M√¥i tr∆∞·ªùng b·∫£o m·∫≠t cao</p>
                        <p>ƒê·ªô nghi√™m: ‚≠ê‚≠ê‚≠ê Nghi√™m ng·∫∑t</p>
                        <pre><code>xccdf_org.ssgproject.content_profile_cis</code><pre>
                    </div>
                    
                    <div class="profile-card">
                        <h4>üèõÔ∏è DISA STIG</h4>
                        <p>Ch√≠nh ph·ªß / Military</p>
                        <p>ƒê·ªô nghi√™m: ‚≠ê‚≠ê‚≠ê‚≠ê R·∫•t nghi√™m</p>
                        <pre><code>xccdf_org.ssgproject.content_profile_stig</code><pre>
                    </div>
                    
                    <div class="profile-card">
                        <h4>üí≥ PCI-DSS v4.0</h4>
                        <p>Payment systems</p>
                        <p>ƒê·ªô nghi√™m: ‚≠ê‚≠ê‚≠ê Nghi√™m ng·∫∑t</p>
                        <pre><code>xccdf_org.ssgproject.content_profile_pci-dss</code><pre>
                    </div>
                    
                    <div class="profile-card">
                        <h4>üè• HIPAA</h4>
                        <p>Healthcare systems</p>
                        <p>ƒê·ªô nghi√™m: ‚≠ê‚≠ê‚≠ê Nghi√™m ng·∫∑t</p>
                        <pre><code>xccdf_org.ssgproject.content_profile_hipaa</code><pre>
                    </div>
                    
                    <div class="profile-card">
                        <h4>üîí OSPP</h4>
                        <p>Common Criteria</p>
                        <p>ƒê·ªô nghi√™m: ‚≠ê‚≠ê V·ª´a ph·∫£i</p>
                        <pre><code>xccdf_org.ssgproject.content_profile_ospp</code><pre>
                    </div>
                </div>
                
                <div class="info">
                    <strong>üí° V√≠ d·ª• s·ª≠ d·ª•ng profile kh√°c:</strong>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        <pre><code># Scan v·ªõi DISA STIG
sudo oscap xccdf eval \
  --fetch-remote-resources \
  --profile xccdf_org.ssgproject.content_profile_stig \
  --results /var/tmp/scap/stig-results.xml \
  --report /var/tmp/scap/stig-report.html \
  /usr/share/xml/scap/ssg/content/ssg-almalinux9-ds.xml</code><pre>
                    </div>
                </div>
            </div>


            <!-- H∆∞·ªõng d·∫´n c√†i roles ch·∫°y ansible cho openscap -->
            <div class="step" id="command">
                <div class="step-header">
                    <div class="step-number">‚öôÔ∏è</div>
                    <div class="step-title">Ch·∫°y b·∫±ng Ansible</div>
                </div>
                <div class="description">
                    <h4>‚ö° M√¥ t·∫£</h4>
                    <p>S·ª≠ d·ª•ng Ansible ƒë·ªÉ t·ª± ƒë·ªông h√≥a vi·ªác c√†i ƒë·∫∑t v√† ch·∫°y OpenSCAP tr√™n nhi·ªÅu m√°y ch·ªß.</p>
                    <ul>
                        <li>‚úÖ C√†i ƒë·∫∑t OpenSCAP v√† scap-security-guide</li>
                        <li>‚úÖ Scan h·ªá th·ªëng v·ªõi profile CIS Level 1 Server</li>
                        <li>‚úÖ T·ª± ƒë·ªông kh·∫Øc ph·ª•c l·ªói b·∫£o m·∫≠t (optional)</li>
                        <li>‚úÖ T·∫°o b√°o c√°o HTML tr∆∞·ªõc/sau v√† backup</li>
                    </ul>
                </div>
                
                <h4 style="margin-top: 20px; margin-bottom: 10px;">üìã B∆∞·ªõc 1: Clone repository</h4>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code>git clone https://github.com/HyHonCuTe/ansible.git
            cd ansible</code></pre>
                </div>
                
                <h4 style="margin-top: 20px; margin-bottom: 10px;">üñ•Ô∏è B∆∞·ªõc 2: C·∫•u h√¨nh inventory</h4>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code>cat > inventory/hosts << 'EOF'
            [linux_servers]
            server1 ansible_host=192.168.1.10 ansible_user=admin
            server2 ansible_host=192.168.1.20 ansible_user=admin
            EOF</code></pre>
                </div>
                
                <h4 style="margin-top: 20px; margin-bottom: 10px;">üöÄ B∆∞·ªõc 3: Ch·∫°y scan (ch·ªâ ki·ªÉm tra)</h4>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <code>ansible-playbook playbooks/scap_check.yml</code>
                </div>
                
                <h4 style="margin-top: 20px; margin-bottom: 10px;">üîß B∆∞·ªõc 4: Ch·∫°y scan v√† auto-fix</h4>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <code>ansible-playbook playbooks/scap_check.yml -e "auto_remediate=true"</code>
                </div>
                
                <div style="background: #d1ecf1; padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid #0c5460;">
                    <strong>üí° K·∫øt qu·∫£:</strong>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>üìÑ HTML reports: <code>roles/scap_check/results/</code></li>
                        <li>üíæ Backups: <code>roles/scap_check/backup/</code></li>
                        <li>üìä Th·ªëng k√™ chi ti·∫øt hi·ªÉn th·ªã tr√™n terminal</li>
                    </ul>
                </div>
                
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #856404;">
                    <strong>‚ö†Ô∏è L∆∞u √Ω:</strong> ƒê·ªçc h∆∞·ªõng d·∫´n chi ti·∫øt c√†i ansible v√† roles t·∫°i:
                    <a href="install.html" style="color: #667eea; font-weight: bold;" target="_blank">
                        C√†i ƒë·∫∑t Ansible v√† Roles
                    </a>
                </div>
            </div>
            
            <!-- Script t·ª± ƒë·ªông -->
            <div class="step" id="script">
                <div class="step-header">
                    <div class="step-number">üöÄ</div>
                    <div class="step-title">Script T·ª± ƒê·ªông Ho√†n Ch·ªânh</div>
                </div>
                
                <div class="description">
                    <h4>‚ö° M√¥ t·∫£</h4>
                    <p>Script t·ª± ƒë·ªông th·ª±c hi·ªán T·∫§T C·∫¢ c√°c b∆∞·ªõc t·ª´ 1-6 trong 1 l·ªánh duy nh·∫•t</p>
                    <ul>
                        <li>‚úÖ T·ª± ƒë·ªông c√†i ƒë·∫∑t</li>
                        <li>‚úÖ Scan tr∆∞·ªõc</li>
                        <li>‚úÖ Backup t·ª± ƒë·ªông</li>
                        <li>‚úÖ H·ªèi x√°c nh·∫≠n tr∆∞·ªõc khi fix</li>
                        <li>‚úÖ Fix v√† scan l·∫°i</li>
                        <li>‚úÖ So s√°nh k·∫øt qu·∫£</li>
                    </ul>
                </div>
                
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code>cat > /tmp/scap_fix.sh << 'EOF'
#!/bin/bash
echo "üöÄ OSCAP Auto-Fix Script"
PROFILE="xccdf_org.ssgproject.content_profile_cis_server_l1"
SCAP="/usr/share/xml/scap/ssg/content/ssg-almalinux9-ds.xml"

# 1. Install
echo "üì¶ [1/6] Installing OpenSCAP..."
sudo dnf install -y openscap-scanner scap-security-guide

# 2. Scan
echo "üîç [2/6] Scanning system..."
sudo mkdir -p /var/tmp/scap
sudo oscap xccdf eval --fetch-remote-resources --profile $PROFILE \
  --results /var/tmp/scap/before.xml --report /var/tmp/scap/before.html $SCAP || true

BEFORE=$(sed -n 's/.*<result>\([^<]*\)<\/result>.*/\1/p' /var/tmp/scap/before.xml | grep -c "^fail$")
echo "   ‚ùå Current failures: $BEFORE"

# 3. Backup
echo "üíæ [3/6] Creating backup..."
BACKUP=~/backup_$(date +%Y%m%d_%H%M%S).tar.gz
sudo tar -czf "$BACKUP" /etc/ssh/ /etc/pam.d/ /etc/security/ /etc/sudoers /etc/sysctl.conf /etc/fstab 2>/dev/null
sudo chown $USER:$USER "$BACKUP"
echo "   ‚úÖ Backup: $BACKUP"

# 4. Confirm
echo ""
read -p "‚ö†Ô∏è  Fix $BEFORE errors? (yes/NO): " CONFIRM
[ "$CONFIRM" != "yes" ] && exit 0

# 5. Fix
echo "üîß [4/6] Running auto-remediation..."
sudo oscap xccdf eval --remediate --fetch-remote-resources --profile $PROFILE \
  --results /var/tmp/scap/after.xml --report /var/tmp/scap/after.html $SCAP 2>&1 | tee /tmp/fix.log

# 6. Compare
echo "üìä [5/6] Analyzing results..."
AFTER=$(sed -n 's/.*<result>\([^<]*\)<\/result>.*/\1/p' /var/tmp/scap/after.xml | grep -c "^fail$")
FIXED=$((BEFORE - AFTER))
PERCENT=$(echo "scale=1;($FIXED*100)/$BEFORE"|bc)

echo ""
echo "üìä ===== FINAL RESULTS ====="
echo "Before: $BEFORE errors"
echo "After:  $AFTER errors"
echo "Fixed:  $FIXED errors ($PERCENT%)"
echo ""
echo "üìÑ Reports:"
echo "   - Before: /var/tmp/scap/before.html"
echo "   - After:  /var/tmp/scap/after.html"
echo "   - Log:    /tmp/fix.log"
echo "üíæ Backup: $BACKUP"
echo ""
echo "üîô To restore: sudo tar -xzf $BACKUP -C /"
EOF

chmod +x /tmp/scap_fix.sh && /tmp/scap_fix.sh</code><pre>
                </div>
                
                <div class="success">
                    <strong>‚úÖ Ch·∫°y script:</strong><br>
                    Ch·ªâ c·∫ßn copy to√†n b·ªô ƒëo·∫°n code tr√™n v√† paste v√†o terminal, script s·∫Ω t·ª± ch·∫°y!
                </div>
            </div>
            
            <!-- Checklist -->
            <div class="checklist">
                <h3>‚úÖ Checklist Tr∆∞·ªõc Khi Fix</h3>
                <div class="checklist-item">
                    <input type="checkbox" id="check1">
                    <label for="check1">ƒê√£ c√†i ƒë·∫∑t OpenSCAP v√† scap-security-guide</label>
                </div>
                <div class="checklist-item">
                    <input type="checkbox" id="check2">
                    <label for="check2">ƒê√£ scan v√† c√≥ file scan-results.xml</label>
                </div>
                <div class="checklist-item">
                    <input type="checkbox" id="check3">
                    <label for="check3">ƒê√£ ƒë·ªçc scan report v√† hi·ªÉu nh·ªØng g√¨ s·∫Ω b·ªã thay ƒë·ªïi</label>
                </div>
                <div class="checklist-item">
                    <input type="checkbox" id="check4">
                    <label for="check4">ƒê√£ t·∫°o backup v√† verify k√≠ch th∆∞·ªõc > 1MB</label>
                </div>
                <div class="checklist-item">
                    <input type="checkbox" id="check5">
                    <label for="check5">C√≥ console access ho·∫∑c ƒë√£ snapshot VM</label>
                </div>
                <div class="checklist-item">
                    <input type="checkbox" id="check6">
                    <label for="check6">ƒê√£ test tr√™n staging/dev tr∆∞·ªõc (n·∫øu l√† production)</label>
                </div>
                <div class="checklist-item">
                    <input type="checkbox" id="check7">
                    <label for="check7">S·∫µn s√†ng test SSH ngay sau khi fix</label>
                </div>
            </div>
            
            <!-- Tips -->
            <div class="info">
                <h4>üí° Tips v√† Best Practices</h4>
                <ul>
                    <li><strong>Test tr√™n staging tr∆∞·ªõc:</strong> ƒê·ª´ng bao gi·ªù ch·∫°y remediation l·∫ßn ƒë·∫ßu tr√™n production</li>
                    <li><strong>C√≥ k·∫ø ho·∫°ch rollback:</strong> Lu√¥n c√≥ backup v√† bi·∫øt c√°ch restore</li>
                    <li><strong>Ch·∫°y ngo√†i gi·ªù cao ƒëi·ªÉm:</strong> M·ªôt s·ªë service c√≥ th·ªÉ restart</li>
                    <li><strong>ƒê·ªçc scan report k·ªπ:</strong> Hi·ªÉu nh·ªØng g√¨ s·∫Ω thay ƒë·ªïi</li>
                    <li><strong>Monitor sau khi fix:</strong> Ki·ªÉm tra logs, services, SSH</li>
                    <li><strong>Document:</strong> Ghi l·∫°i nh·ªØng g√¨ ƒë√£ fix v√† k·∫øt qu·∫£</li>
                </ul>
            </div>
            
            <!-- Troubleshooting -->
            <div class="warning">
                <strong>üîß Troubleshooting Th∆∞·ªùng G·∫∑p</strong>
                <ul>
                    <li><strong>SSH b·ªã lock:</strong> Login qua console, restore backup SSH: <pre><code>sudo tar -xzf ~/backup_*.tar.gz /etc/ssh/ -C /</code><pre></li>
                    <li><strong>Services kh√¥ng start:</strong> Ki·ªÉm tra log: <pre><code>journalctl -xe</code><pre></li>
                    <li><strong>Fix 0%:</strong> M·ªôt s·ªë l·ªói c·∫ßn fix th·ªß c√¥ng ho·∫∑c c·∫ßn reboot</li>
                    <li><strong>Compliance v·∫´n th·∫•p:</strong> M·ªôt s·ªë rules kh√¥ng th·ªÉ t·ª± ƒë·ªông (VD: partition ri√™ng)</li>
                </ul>
            </div>
        </div>
        
        <footer>
            <p>&copy; 2025 OpenSCAP Guide | AlmaLinux 9 | CIS Benchmark</p>
            <p>T·∫°o b·ªüi: HyHonCuTe | C·∫≠p nh·∫≠t: 2025-10-11 15:38:29 UTC</p>
        </footer>
    </div>
    
    <script>
        function copyCode(button) {
            const codeBlock = button.nextElementSibling;
            const code = codeBlock.textContent;
            
            navigator.clipboard.writeText(code).then(() => {
                // Show toast
                const toast = document.getElementById('toast');
                toast.style.display = 'block';
                
                // Change button text
                const originalText = button.textContent;
                button.textContent = '‚úì Copied!';
                button.style.background = '#28a745';
                
                // Reset after 2 seconds
                setTimeout(() => {
                    toast.style.display = 'none';
                    button.textContent = originalText;
                    button.style.background = '#667eea';
                }, 2000);
            }).catch(err => {
                alert('L·ªói copy: ' + err);
            });
        }
        
        // Smooth scroll for TOC links
        document.querySelectorAll('.toc a').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            });
        });
        
        // Save checklist state to localStorage
        document.querySelectorAll('.checklist-item input').forEach(checkbox => {
            const id = checkbox.id;
            checkbox.checked = localStorage.getItem(id) === 'true';
            
            checkbox.addEventListener('change', () => {
                localStorage.setItem(id, checkbox.checked);
            });
        });
    </script>
</body>
</html>