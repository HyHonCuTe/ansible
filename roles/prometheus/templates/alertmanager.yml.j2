# Alertmanager Configuration
# Generated by Ansible - {{ ansible_date_time.iso8601 }}
# Author: hyhoncute

global:
  resolve_timeout: 5m

route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 12h
  receiver: 'default'

receivers:
{% for receiver in alertmanager_receivers %}
  - name: '{{ receiver.name }}'
    {% if receiver.webhook_configs is defined %}
    webhook_configs:
    {% for webhook in receiver.webhook_configs %}
      - url: '{{ webhook.url }}'
        {% if webhook.send_resolved is defined %}
        send_resolved: {{ webhook.send_resolved }}
        {% endif %}
    {% endfor %}
    {% endif %}
    {% if receiver.email_configs is defined %}
    email_configs:
    {% for email in receiver.email_configs %}
      - to: '{{ email.to }}'
        {% if email.from is defined %}
        from: '{{ email.from }}'
        {% endif %}
        {% if email.smarthost is defined %}
        smarthost: '{{ email.smarthost }}'
        {% endif %}
    {% endfor %}
    {% endif %}
{% endfor %}

inhibit_rules:
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'instance']